import * as fs from "fs-extra";
import pako from "pako";
import * as path from "path";
import { BCVE, Dir } from "../../../../../src/persistent-types";

function addData(data: object, dir: string, id: string) {
  fs.writeFileSync(
    path.join(dir, `${id}.pako`),
    pako.deflate(JSON.stringify(data))
  );
}

export function makeContent(dir: Dir, bcves: BCVE[], bcvesWithRuns: BCVE[]) {
  fs.rmdirSync(dir, { recursive: true });
  fs.mkdirSync(dir, { recursive: true });
  fs.writeFileSync(
    path.join(dir, "index.html"),
    `
<!doctype html>
<html>
  <head>
  </head>
  <body>
    <div id="main"></div>
    <script type="text/javascript" src="main.js"></script>
  </body>
</html>
`.trim(),
    "utf8"
  );
  fs.copySync(path.join(__dirname, "../../../../../../webpack/dist"), dir);
  addData(bcves, dir, "bcves");
  addData(bcvesWithRuns, dir, "bcvesWithRuns");

  console.log(`HTML content has been generated at ${dir}.`);
}
